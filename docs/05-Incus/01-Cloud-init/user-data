#cloud-config 

groups:
  - admin
  - users

users:
  - name: opako
    groups: [admin, sudo, users]
    # cyh..
    passwd: $6$alous$yTm4iDPQFbJ8kdbhDD4MG5GBLuc/KkYV3r.i9QfRL6iduv85Eg6jVYS5tZBNI/Wftr3JqHC3C94vOZkR2H2S7.
    lock_passwd: false
    sudo:
      - ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl3Bx5l0v2X1Rouy7e1uDkN3ZkLdqn9EfO2YEeox2CsL0ogwKmnD/xy4CWRIcpivTggEd+XtI0dF/OPbMwP9b6iE0hij2dt19QpkQNsV0P+I4PkMJW9qZgpl0hC/8ZjCDFeTR8t4K7e9E0oU0HW4e7YgMySE310c4aDEgpWdaUKWzpCKbyLw1Bjwbydo9/cyFcwxJ/1sJpeqp3S561QcFNaZ2mXxWk9jSpyRFr3kYXxaSs73jHS3rpN7b2Tu/gK0OBZyWjKhYycfAJsdAM2tEwU6xQ6RcWIoN+DOW7euqpHvI4z0Aor2PJAtuiewSD/sizS7SXUUtuSMCxsiZts2M9 opako

packages:
  - nano
  - ssh
  - wget
  - curl
  - tree

runcmd:
  # Timezone
  - timedatectl set-timezone Europe/Helsinki
  
  # Configure bashrc
  - sed -i 's/#force_color_prompt=yes/force_color_prompt=yes/' /home/opako/.bashrc
  
  # Configure SSH
  - sed -i -e '/^\(#\|\)PermitRootLogin/s/^.*$/PermitRootLogin no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)PasswordAuthentication/s/^.*$/PasswordAuthentication no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)KbdInteractiveAuthentication/s/^.*$/KbdInteractiveAuthentication no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)ChallengeResponseAuthentication/s/^.*$/ChallengeResponseAuthentication no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)MaxAuthTries/s/^.*$/MaxAuthTries 2/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)AllowTcpForwarding/s/^.*$/AllowTcpForwarding no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)X11Forwarding/s/^.*$/X11Forwarding no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)AllowAgentForwarding/s/^.*$/AllowAgentForwarding no/' /etc/ssh/sshd_config
  - sed -i -e '/^\(#\|\)AuthorizedKeysFile/s/^.*$/AuthorizedKeysFile .ssh\/authorized_keys/' /etc/ssh/sshd_config
  - sed -i '$a AllowUsers opako' /etc/ssh/sshd_config
  - sed -i '$a Port 22' /etc/ssh/sshd_config

  - systemctl restart ssh